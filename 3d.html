<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-US">
<head>
	<meta http-equiv="Content-type" content="text/html; charset=utf-8" />
	<title>Canvas</title>
	
	<style type="text/css" media="screen">
	* { margin: 0; padding: 0; outline: 0; }
	html, body { text-align: center; color: #444; background: #f3f3f3; font-family: courier; height: 100%; user-select: none; -webkit-user-select: none; -moz-user-select: -moz-none; }
	#page { width: 802px; margin: 0 auto; height: auto !important;min-height: 100%; }
	canvas { border: 1px solid #ddd; cursor: crosshair; margin-top: 30px; margin-bottom: 10px }
	a { color: white; text-decoration: none }
	p { text-align: left; padding-bottom: 10px }
	p a { margin: 3px; padding: 0 6px; }
	.left { float: left; }
	.right { float: right; }
	#page:after { content: "."; visibility: hidden; display: block; height: 0; line-height: 0; font-size: 0; clear: both; }
	#speed-slow { color: #d33d2e; }
	#speed-normal { color: #f3dd2f; }
	#speed-high { color: #53bb44; }
	</style>
	
	<script src="ncanvas.js" type="text/javascript" language="javascript" charset="utf-8" ></script>
	<script src="ncanvas-text.js" type="text/javascript" language="javascript" charset="utf-8" ></script>
	<script type="text/javascript" language="javascript" charset="utf-8">
	
	function init() {
		var $$ = function(id) { return window.document.getElementById(id) };
		var n = $$("area").getNCanvas();
		//n.autoClear = false;
		n.node.globalAlpha = 1
		
		var mainScene = new NScene({name: 'main', fps: 40});
		var stroke = '#4da612';
		
		var style_2 = new NStyle({color: '#000', lineColor: '#000', fillType: 'stroke'});
		var style_c = new NStyle({color: '#c92424', lineColor: '#c92424', fillType: 'stroke'});
		var style_2_front = new NStyle({color: '#000', lineColor: '#000', fillType: 'fill'});
		var style_c_front = new NStyle({color: '#c92424', lineColor: '#c92424', fillType: 'fill'});
		
		var s = 200;
		var points = [
			// 2
			new NPoint({x: -3.5*s, y: -2.5*s, z: 0, style: style_2}),
			new NPoint({x: -1.5*s, y: -2.5*s, z: 0, style: style_2}),
			new NPoint({x: -1.5*s, y: -0.5*s, z: 0, style: style_2}),
			new NPoint({x: -3.5*s, y: -0.5*s, z: 0, style: style_2}),
			new NPoint({x: -3.5*s, y: 2.5*s, z: 0, style: style_2}),
			new NPoint({x: -0.5*s, y: 2.5*s, z: 0, style: style_2}),
			new NPoint({x: -0.5*s, y: 1.5*s, z: 0, style: style_2}),
			new NPoint({x: -2.5*s, y: 1.5*s, z: 0, style: style_2}),
			new NPoint({x: -2.5*s, y: 0.5*s, z: 0, style: style_2}),
			new NPoint({x: -0.5*s, y: 0.5*s, z: 0, style: style_2}),
			new NPoint({x: -0.5*s, y: -1.5*s, z: 0, style: style_2}),
			new NPoint({x: -3.5*s, y: -1.5*s, z: 0, style: style_2}),
			// c
			new NPoint({x: 0.5*s, y: -1.5*s, z: 0, style: style_c}),
			new NPoint({x: 3.5*s, y: -1.5*s, z: 0, style: style_c}),
			new NPoint({x: 3.5*s, y: -0.5*s, z: 0, style: style_c}),
			new NPoint({x: 1.5*s, y: -0.5*s, z: 0, style: style_c}),
			new NPoint({x: 1.5*s, y: 1.5*s, z: 0, style: style_c}),
			new NPoint({x: 3.5*s, y: 1.5*s, z: 0, style: style_c}),
			new NPoint({x: 3.5*s, y: 2.5*s, z: 0, style: style_c}),
			new NPoint({x: 0.5*s, y: 2.5*s, z: 0, style: style_c}),
		];
		
		for	(index in points) {
			points[index].z += s*0.5;
			points[index].lineColor = points[index].color;
			points.push(new NPoint({x: points[index].x, y: points[index].y, z: points[index].z - s*1, style: points[index].style}));
		}
		
		var poly = new NPolygon({x: n.width/2, y: n.height/2, z: -3000});
		poly.setPoints(points);
		// front
		poly.connectRange(style_2_front, 0, 11);
		poly.connectRange(style_2, 20, 31);
		
		poly.connectRange(style_c_front, 12, 19);
		poly.connectRange(style_c, 32, 39);
		
		// side
		poly.connect(style_2, 0, 20, 31, 11);
		poly.connect(style_2, 1, 21, 22, 2);
		poly.connect(style_2, 10, 30, 29, 9);
		poly.connect(style_2, 3, 23, 24, 4);
		poly.connect(style_2, 8, 28, 27, 7);
		poly.connect(style_2, 6, 26, 25, 5);
		
		poly.connect(style_c, 12, 32, 39, 19);
		poly.connect(style_c, 13, 33, 34, 14);
		poly.connect(style_c, 17, 37, 38, 18);
		poly.connect(style_c, 15, 35, 36, 16);
		// top
		poly.connect(style_2, 0, 20, 21, 1);
		poly.connect(style_2, 11, 31, 30, 10);
		poly.connect(style_2, 3, 23, 22, 2);
		poly.connect(style_2, 8, 28, 29, 9);
		poly.connect(style_2, 7, 27, 26, 6);
		poly.connect(style_2, 4, 24, 25, 5);
		
		poly.connect(style_c, 12, 32, 33, 13);
		poly.connect(style_c, 15, 35, 34, 14);
		poly.connect(style_c, 16, 36, 37, 17);
		poly.connect(style_c, 19, 39, 38, 18);
		
		
		var camera = new NPoint({x: n.width/2, y: n.height/2, z: 800, color: '#6FAC24'});
		
		var k = 0.1;
		var anim = {x: poly.x, y: poly.y, z: poly.z, rx: 0, ry: 0, rz: poly.rotationZ};
		
		mainScene.addListener('onEnterFrame', function(e) {
			
			poly.rotationX += (anim.rx - poly.rotationX)*k
			poly.rotationY += (anim.ry - poly.rotationY)*k
			poly.rotationZ += (anim.rz - poly.rotationZ)*k
			poly.x += (anim.x - poly.x)*k
			poly.y += (anim.y - poly.y)*k
			poly.z += (anim.z - poly.z)*k
			
			poly.draw(n.node, camera);
		});
		
		n.node.canvas.onmousemove = function(e) {
			anim.rx = ((n.height/2 - (e.clientY - e.target.offsetTop))/(n.height/2)) * Math.PI/6
			anim.ry = (((e.clientX - e.target.offsetLeft) - n.width/2)/(n.width/2)) * Math.PI/6
			
			anim.y = e.clientY - e.target.offsetTop
			anim.x = e.clientX - e.target.offsetLeft
		}
		
		n.node.canvas.onmousedown = function(e) {
			poly.style.skeleton = !poly.style.skeleton;
			
			window.document.body.style.background = window.document.documentElement.style.background = poly.style.skeleton?'#111':'#f3f3f3';
			$$('area').style.borderColor = poly.style.skeleton?'#6FAC24':'#ddd';
			style_2_front.lineColor = style_2_front.color = style_2.lineColor = style_2.color = poly.style.skeleton?'#6FAC24':'black';
			style_c_front.lineColor = style_c_front.color = style_c.lineColor = style_c.color = poly.style.skeleton?'#6FAC24':'#c92424';
		}
		
		n.node.canvas.onmousewheel = function(e) {
			var step = 1 - 2*(e.wheelDelta < 0);
			anim.z = Math.min(Math.max(anim.z + step*200, -5000), -2000);
			return false;
		}
		
		$$('speed-slow').onmousedown = function() { n.stop().play(mainScene, 10); return false; }
		$$('speed-normal').onmousedown = function() { n.stop().play(mainScene, 30); return false; }
		$$('speed-high').onmousedown = function() { n.stop().play(mainScene, 60); return false; }
		
		n.play(mainScene, mainScene.fps);
	}
	</script>
</head>
<body onload="init();">
	<div id="page">
		<canvas id="area" width="800" height="600">Here be dragons ...</canvas>
		<p class="left">Speed: <a id="speed-slow" href="#">slow</a><a id="speed-normal" href="#">normal</a><a id="speed-high" href="#">high</a></p>
		<p class="right" id="nature">By Siyan Panayotov</p>
	</div>
</body>
</html>
